select count(*) as ROWS from (SELECT  row_number() over(order by dbo.getOne(TESTPLAN.COURSENO)) as row,dbo.getOne(TESTPLAN.COURSENO) AS kh,
dbo.getOne(COURSES.COURSENAME) AS km,
dbo.getOne(TESTPLAN.ATTENDENTS) AS xkrs,
dbo.getOne(TESTPLAN.ROOMNO1) AS kcc1,
dbo.getOne(TESTPLAN.SEATS1) as kw1,
dbo.getOne(TESTPLAN.ROOMNO2) AS kcc2,
dbo.getOne(TESTPLAN.SEATS2) as kw2,
dbo.getOne(TESTPLAN.ROOMNO3) AS kcc3,
dbo.getOne(TESTPLAN.SEATS3) as kw3,
dbo.getOne(TESTPLAN.rem) as rem,
dbo.getOne('['+RTRIM(CAST(TESTPLAN.FLAG AS CHAR))+']'+TESTBATCH.TESTTIME) AS kssj,
dbo.getOne(('['+RTRIM(TESTPLAN.监考教师1)+']'+ISNULL(TEACHER1.NAME,' ')) +','+ ('['+RTRIM(TESTPLAN.监考教师2)+']'+ISNULL(TEACHER2.NAME,' ')) +','+ ('['+RTRIM(TESTPLAN.监考教师3)+']'+ISNULL(TEACHER3.NAME,' '))) AS ST1,
dbo.getOne(('['+RTRIM(TESTPLAN.监考教师4)+']'+ISNULL(TEACHER4.NAME,' ')) +','+ ('['+RTRIM(TESTPLAN.监考教师5)+']'+ISNULL(TEACHER5.NAME,' '))+','+ ('['+RTRIM(TESTPLAN.监考教师6)+']'+ISNULL(TEACHER6.NAME,' '))) AS ST2,
dbo.getOne(('['+RTRIM(TESTPLAN.监考教师7)+']'+ISNULL(TEACHER7.NAME,' ')) +','+ ('['+RTRIM(TESTPLAN.监考教师8)+']'+ISNULL(TEACHER8.NAME,' ')) +','+('['+RTRIM(TESTPLAN.监考教师9)+']'+ISNULL(TEACHER9.NAME,' '))) AS ST3,

 dbo.getOne(('['+RTRIM(TESTPLAN.监考教师1)+']')) AS JSNO1,
dbo.getOne(('['+RTRIM(TESTPLAN.监考教师2)+']')) AS JSNO2,
 dbo.getOne(('['+RTRIM(TESTPLAN.监考教师3)+']')) AS JSNO3,
 dbo.getOne(('['+RTRIM(TESTPLAN.监考教师4)+']')) AS JSNO4,
 dbo.getOne(('['+RTRIM(TESTPLAN.监考教师5)+']')) AS JSNO5,
 dbo.getOne(('['+RTRIM(TESTPLAN.监考教师6)+']')) AS JSNO6,
 dbo.getOne(('['+RTRIM(TESTPLAN.监考教师7)+']')) AS JSNO7,
 dbo.getOne(('['+RTRIM(TESTPLAN.监考教师8)+']')) AS JSNO8,
 dbo.getOne(('['+RTRIM(TESTPLAN.监考教师9)+']')) AS JSNO9,
 dbo.getOne(ISNULL(TEACHER1.NAME,' ')) AS JSXM1,
 dbo.getOne(ISNULL(TEACHER2.NAME,' ')) AS JSXM2,
 dbo.getOne(ISNULL(TEACHER3.NAME,' ')) AS JSXM3,
 dbo.getOne(ISNULL(TEACHER4.NAME,' ')) AS JSXM4,
 dbo.getOne(ISNULL(TEACHER5.NAME,' ')) AS JSXM5,
 dbo.getOne(ISNULL(TEACHER6.NAME,' ')) AS JSXM6,
 dbo.getOne(ISNULL(TEACHER7.NAME,' ')) AS JSXM7,
 dbo.getOne(ISNULL(TEACHER8.NAME,' ')) AS JSXM8,
 dbo.getOne(ISNULL(TEACHER9.NAME,' ')) AS JSXM9,
dbo.getOne(RTRIM(CAST(TESTPLAN.R15 AS CHAR)))AS R15,
dbo.getOne('['+COURSEPLAN.CLASSNO+']'+RTRIM(CLASSES.CLASSNAME)) AS CLASS,
' ' as SL, ' ' as KC2,' ' as KC3
FROM TESTPLAN JOIN COURSES ON LEFT(TESTPLAN.COURSENO,7)=COURSES.COURSENO
LEFT OUTER JOIN TESTBATCH ON TESTPLAN.FLAG=TESTBATCH.FLAG and TESTPLAN.year=TESTBATCH.year and TESTPLAN.term=TESTBATCH.term
JOIN SCHEDULEPLAN ON TESTPLAN.R10=SCHEDULEPLAN.RECNO
AND SCHEDULEPLAN.YEAR = :YEAR  AND SCHEDULEPLAN.TERM =:TERM
JOIN COURSEPLAN ON LEFT(TESTPLAN.COURSENO,7)=COURSEPLAN.COURSENO
AND RIGHT(TESTPLAN.COURSENO,2)=COURSEPLAN.[GROUP]
JOIN CLASSES ON COURSEPLAN.CLASSNO=CLASSES.CLASSNO AND CLASSES.CLASSNO LIKE :CLASSNO
AND SCHEDULEPLAN.YEAR=COURSEPLAN.YEAR AND SCHEDULEPLAN.TERM=COURSEPLAN.TERM
LEFT OUTER JOIN (SELECT TEACHERNO,NAME,SCHOOL FROM TEACHERS WHERE  TEACHERNO LIKE '%')AS TEACHER1 ON TESTPLAN.监考教师1=TEACHER1.TEACHERNO
LEFT OUTER JOIN (SELECT TEACHERNO,NAME,SCHOOL FROM TEACHERS WHERE  TEACHERNO LIKE '%')AS TEACHER2 ON TESTPLAN.监考教师2=TEACHER2.TEACHERNO
LEFT OUTER JOIN (SELECT TEACHERNO,NAME,SCHOOL FROM TEACHERS WHERE  TEACHERNO LIKE '%')AS TEACHER3 ON TESTPLAN.监考教师3=TEACHER3.TEACHERNO
LEFT OUTER JOIN (SELECT TEACHERNO,NAME,SCHOOL FROM TEACHERS WHERE  TEACHERNO LIKE '%')AS TEACHER4 ON TESTPLAN.监考教师4=TEACHER4.TEACHERNO
LEFT OUTER JOIN (SELECT TEACHERNO,NAME,SCHOOL FROM TEACHERS WHERE  TEACHERNO LIKE '%')AS TEACHER5 ON TESTPLAN.监考教师5=TEACHER5.TEACHERNO
LEFT OUTER JOIN (SELECT TEACHERNO,NAME,SCHOOL FROM TEACHERS WHERE  TEACHERNO LIKE '%')AS TEACHER6 ON TESTPLAN.监考教师6=TEACHER6.TEACHERNO
LEFT OUTER JOIN (SELECT TEACHERNO,NAME,SCHOOL FROM TEACHERS WHERE  TEACHERNO LIKE '%')AS TEACHER7 ON TESTPLAN.监考教师7=TEACHER7.TEACHERNO
LEFT OUTER JOIN (SELECT TEACHERNO,NAME,SCHOOL FROM TEACHERS WHERE  TEACHERNO LIKE '%')AS TEACHER8 ON TESTPLAN.监考教师8=TEACHER8.TEACHERNO
LEFT OUTER JOIN (SELECT TEACHERNO,NAME,SCHOOL FROM TEACHERS WHERE  TEACHERNO LIKE '%')AS TEACHER9 ON TESTPLAN.监考教师9=TEACHER9.TEACHERNO
WHERE TESTPLAN.FLAG LIKE :CHANGCI
AND (
TESTPLAN.监考教师1 LIKE :TONE OR TESTPLAN.监考教师2 LIKE :TTWO OR TESTPLAN.监考教师3 LIKE :TTHREE OR
TESTPLAN.监考教师4 LIKE :TFOUR OR TESTPLAN.监考教师5 LIKE :TFIVE OR TESTPLAN.监考教师6 LIKE :TSIX OR
TESTPLAN.监考教师7 LIKE :TSEVEN OR TESTPLAN.监考教师8 LIKE :TEIGHT OR TESTPLAN.监考教师9 LIKE :TNINE)
AND (TEACHER1.SCHOOL LIKE :SONE OR TEACHER2.SCHOOL LIKE :STWO OR TEACHER3.SCHOOL LIKE :STHREE OR
TEACHER4.SCHOOL LIKE :SFOUR OR TEACHER5.SCHOOL LIKE :SFIVE OR TEACHER6.SCHOOL LIKE :SSIX OR
TEACHER7.SCHOOL LIKE :SSEVEN OR TEACHER8.SCHOOL LIKE :SEIGHT OR TEACHER9.SCHOOL LIKE :SNINE)
AND COURSEPLAN.SCHOOL LIKE :COURSESCHOOL
group by TESTPLAN.COURSENO
) as b