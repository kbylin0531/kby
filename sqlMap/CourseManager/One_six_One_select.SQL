select * from(SELECT row_number() over(ORDER BY SELECTION.TOTALSELECTED DESC,R32.STUDENTNO) as row,
R32.STUDENTNO as xh,STUDENTS.NAME AS xm,R32.COURSENO+R32.[GROUP] AS kh,
COURSES.COURSENAME as km,COURSES.CREDITS as xf,SELECTION.TOTALSELECTED as clkcxkms,CAST(R32.INPROGRAM AS CHAR) AS xkjhn
FROM R32 JOIN COURSES ON R32.COURSENO=COURSES.COURSENO
INNER JOIN (
SELECT R32.YEAR,R32.TERM,R32.STUDENTNO,COURSEPLAN.CLASSNO,COUNT(*) AS TOTALSELECTED
FROM R32 INNER JOIN COURSEPLAN ON
R32.COURSENO=COURSEPLAN.COURSENO
AND R32.[GROUP]=COURSEPLAN.[GROUP]
AND R32.YEAR=COURSEPLAN.YEAR
AND R32.TERM=COURSEPLAN.TERM
WHERE COURSEPLAN.CLASSNO LIKE :CONE
GROUP BY R32.STUDENTNO,COURSEPLAN.CLASSNO,R32.YEAR,R32.TERM) AS SELECTION
ON R32.STUDENTNO=SELECTION.STUDENTNO AND R32.YEAR=SELECTION.YEAR AND R32.TERM=SELECTION.TERM
JOIN STUDENTS ON R32.STUDENTNO=STUDENTS.STUDENTNO
INNER JOIN COURSEPLAN ON
R32.COURSENO=COURSEPLAN.COURSENO
AND R32.[GROUP]=COURSEPLAN.[GROUP]
AND R32.YEAR=COURSEPLAN.YEAR
AND R32.TERM=COURSEPLAN.TERM
AND SELECTION.CLASSNO=COURSEPLAN.CLASSNO
WHERE COURSEPLAN.CLASSNO LIKE :CTWO
AND R32.YEAR=:YEAR
AND R32.TERM=:TERM
AND SELECTION.TOTALSELECTED>:LIMIT
) as b where b.row between :start and :end