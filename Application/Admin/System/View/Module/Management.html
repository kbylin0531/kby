{extends file="../../../View/base.html"}
{block name='script'}
<script>
    $(function () {
        var ctler_uri = '{$smarty.const.__CONTROLLER__}/';
        var datatable = $('#dtable');
        var tableManager = Dazzling.datatables.bind(datatable,{
            "dom": '<"toolbar">frtip',
            'columns':[
                {
                    'title':'ID',
                    'width':'8%',
                    'data':'id'
                },
                {
                    'title':'名称',
                    'width':'20%',
                    'className':'text_align_center',
                    'data':'title'
                },
                {
                    'title':'状态',
                    'width':'8%',
                    'className':'text_align_center',
                    'data':function(row){
//                        console.log(row)
                        return parseInt(row.status)?'启用':'禁止';
                    }
                },
                {
                    'title':'排序',
                    'width':'8%',
                    'className':'text_align_center',
                    'data':'order'
                },
                {
                    'title':'代号',
                    'width':'15%',
                    'data':'code'
                },
                {
                    'title':'描述',
                    'data':'description'
                }
            ]
        }).onDraw(function () {
            //设置上下文菜单
            Dazzling.contextmenu.create(
                    datatable.find("tr"),
                    [
                        {
                            'edit':'编辑',
                            'delete':'删除'
                        },
                        {
                            'deleteSelected':'删除选中'
                        }
                    ],
                    function(element,tabindex,title){
                        var data = tableManager.data(element);
//                                    console.log(tabindex,title,element);
                        switch (tabindex){
                            case 'edit':
                                Dazzling.form.autoFill("#form_module",data,[
                                    'id','title','order','description','status',
                                    'code','parent'
                                ]);
                                Dazzling.modal.show(editModal);
                                break;
                            case 'delete':
                                break;
                            case 'deleteSelect':
                                break;
                        }
                    }
            );
        });

        var editModal = Dazzling.modal.create('#editModule',{
            'title':'编辑模块',
            'confirm':function () {
                var obj = dazz.utils.parseUrl(Dazzling.form.serialize("#form_module"));
                Dazzling.post(ctler_uri+'updateModule',obj,function (data) {
                    if(data['_type'] > 0){
                        //更新对象
                        tableManager.update(obj);
                        //只有成功时才会自动消失
                        Dazzling.modal.hide(editModal);
                    }
                });
            },
            'cancel':function () {
                Dazzling.modal.hide(editModal);
            }
        });
        var loadData = function () {
            Dazzling.post(
                    ctler_uri+'listModule',
                    {},
                    function (data) {
                        tableManager.load(data);
                    }
            );
        };
        loadData();
        Dazzling.page.registerAction('刷新',function () {
            loadData();
            Dazzling.toast.success('加载完成!');
        });

    });
</script>
{/block}
{block name='stage'}
<div id="editModule" >
    <form class="form-horizontal" id="form_module" role="form" >
        <div class="form-group">
            <label class="col-sm-2 control-label">名称</label>
            <div class="col-sm-6">
                <input type="text" class="form-control input-sm" name="title" placeholder="请输入模块名称">
            </div>
        </div>
        <div class="form-group">
        </div>
        <div class="form-group">
            <label class="col-sm-2 control-label">描述</label>
            <div class="col-md-10">
                <input type="text" class="form-control input-sm" name="description" placeholder="描述模块的信息">
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-2 control-label">排序</label>
            <div class="col-sm-4">
                <input type="text" value="0" class="form-control input-sm" name="order" placeholder="">
                <span class="help-block">大的序号可以保持模块在列表中处于靠前 </span>
            </div>
            <label class="col-sm-2 control-label">启用状态</label>
            <div class="checkbox col-md-4">
                <label>
                    <input type="radio" value="1" name="status"> 启用
                    <input type="radio" value="0" name="status"> 禁用
                </label>
            </div>
        </div>
    </form>
</div>
<table id="dtable" class="display table-condensed table-bordered" cellspacing="0" width="100%"></table>
{/block}